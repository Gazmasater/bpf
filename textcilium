
Включите необходимые параметры ядра:

sudo sysctl -w net.core.bpf_jit_enable=1
sudo sysctl -w net.ipv4.ip_forward=1
sudo sysctl -w kernel.unprivileged_bpf_disabled=1

Установите Cilium CLI:
CLI позволит вам управлять Cilium и проверять его состояние:

CLI_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/cilium-cli/main/stable.txt)
curl -L --remote-name-all https://github.com/cilium/cilium-cli/releases/download/$CLI_VERSION/cilium-linux-amd64.tar.gz{,.sha256sum}
sha256sum --check cilium-linux-amd64.tar.gz.sha256sum
sudo tar xzvfC cilium-linux-amd64.tar.gz /usr/local/bin
rm cilium-linux-amd64.tar.gz{,.sha256sum}

Скачайте бинарный файл Cilium Agent
Сначала загрузите и установите последний релиз Cilium Agent:

CILIUM_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/cilium/v1.11.6/stable.txt)
curl -L --output cilium-agent https://github.com/cilium/cilium/releases/download/$CILIUM_VERSION/cilium-agent
chmod +x cilium-agent
sudo mv cilium-agent /usr/local/bin/

2. Создайте папку для конфигурации
Создайте директорию для хранения конфигурационных файлов Cilium:

sudo mkdir -p /etc/cilium
Если у вас есть специфическая конфигурация, создайте или скопируйте файл конфигурации
в /etc/cilium/config.yaml. Обычно этот файл содержит настройки сети и другие параметры.

3. Создайте Unit-файл для systemd
Создайте Unit-файл для запуска Cilium как службы:

sudo nano /etc/systemd/system/cilium-agent.service

Добавьте в файл следующие строки:

[Unit]
Description=Cilium Agent
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/cilium-agent --config-dir=/etc/cilium
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target

4. Запустите и включите службу
Загрузите новый Unit-файл, затем запустите и включите Cilium Agent:

sudo systemctl daemon-reload
sudo systemctl start cilium-agent
sudo systemctl enable cilium-agent

5. Проверьте статус службы
Убедитесь, что Cilium Agent успешно запустился:

sudo systemctl status cilium-agent

gaz358@gaz358-BOD-WXX9:~/myprog$ sudo systemctl status cilium-agent
● cilium-agent.service - Cilium Agent
     Loaded: loaded (/etc/systemd/system/cilium-agent.service; enabled; preset: enabled)
     Active: activating (auto-restart) (Result: exit-code) since Fri 2024-10-25 22:05:25 MSK; 2s ago
    Process: 7018 ExecStart=/usr/local/bin/cilium-agent --config-dir=/etc/cilium (code=exited, status=203/EXEC)
   Main PID: 7018 (code=exited, status=203/EXEC)
        CPU: 985us
